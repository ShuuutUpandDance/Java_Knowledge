## Volatile 与共享变量
在多线程中，synchronized　和　volatile　都起到控制**共享资源**的作用，而 volatile 可以看作是轻量级的　synchronized，使用　volatile 保证了共享变量的**“可见性”**（即当一个线程修改某一共享变量时，另一个线程能读到修改后的值）。volatile　修饰符使用恰当的话，比 synchronized　的使用和执行成本更低，因为不会引起线程上下文的切换和调度。

#### 1. 定义
Java　语言规范对　volatile 的定义如下：Java 编程语言允许线程访问共享变量，为了确保共享变量能被**准确且一致地**更新，线程应该确保通过**排他锁**单独获得这个变量。Java 语言提供了　volatile，在某些情况下比锁要更加方便。如果一个字段被声明成　volatile，Java 线程内存模型确保**所有线程**看到的该变量的值是**一致**的。

#### 2. 实现原理
有　volatile 修饰的共享变量在进行**写操作**时比普通变量多了一条　lock 前缀的指令，该指令在多核处理器下引发两件事情：
1. 将当前处理器缓存行的数据写回到系统内存；
2. 这个写回内存的操作会使其他　cpu 中缓存了该内存地址的数据无效。

也就是说，通过**直接写回内存使得其他 cpu 的缓存无效**，来保证所有 cpu 看到的值都是一致的。
